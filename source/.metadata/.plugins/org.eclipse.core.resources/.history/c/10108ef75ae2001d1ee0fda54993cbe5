<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<title>두꺼비 : 새집 다오</title>

<c:set value="${pageContext.request.contextPath}" var="context"/>

<link rel="stylesheet" href="${context}/resources/js/bootstrap-5.2.3-dist/css/bootstrap.min.css">    
<link rel="stylesheet" href="${context}/resources/js/ol/ol.css">
<link rel="stylesheet" href="${context}/resources/css/index.css">

</head>
<body>

<div id="map">

	<!-- 배경장막 -->
	<div id="veil" class="veiled"></div>
	
	<!-- 대메뉴 -->
	<div id="menu" class="tile bigMenu">
		<input type="text" id="search" class="bigMenuSearch" placeholder="키워드로 검색하기"/>
		<button id="inquire" class="menuBtn bigMenuBtn">주거 현황 조회</button>
		<button id="observe" class="menuBtn bigMenuBtn">주거적지 탐색</button>
		<button id="analyze" class="menuBtn bigMenuBtn">주거적지 분석</button>
		<button id="history" class="menuBtn bigMenuBtn">분석 결과 내역</button>		
	</div>
	
	<!-- 사이드 메뉴 -->
	<div id="side" class="tile">
		<button class="backBtn">←</button>
		<div id="search1" class="tile sideMenu fold1">
			<div class="sideHeader">지역선택</div>
			<select class="form-control selectForm"></select>
			<select id="selectSgg" class="form-control selectForm"></select>
			<select class="form-control selectForm"></select>
			<div class="resultForm">선택한 주소 : <span id="resultAddr">시/도 시/군/구 읍/면/동</span></div>
			<button id="searchBtn1" class="btn btn-primary searchBtn">검색</button>
		</div>
		<div id="safety1" class="tile sideMenu unfold1">
			<div class="sideHeader">안전현황</div>
		
		</div>
		<div id="poi1" class="tile sideMenu unfold1">
			<div class="sideHeader">주요지점</div>

		</div>
		<div id="cost1" class="tile sideMenu unfold1">
			<div class="sideHeader">실거래가</div>
		
		</div>
	</div>
	
</div>

<script src="${context}/resources/js/ol/ol.js"></script>
<script src="${context}/resources/js/ol/jsts.min.js"></script>
<script src="${context}/resources/js/ol/proj4js-2.3.14.js"></script>
<script src="${context}/resources/js/jquery-3.6.1.min.js"></script>
<script src="${context}/resources/js/index.js"></script>

<script>
/* ===================main=================== */
//좌표계 설정
proj4.defs('EPSG:3857', '+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=GRS80 +units=m +no_defs');
ol.proj.proj4.register(proj4);

//지도
const map = new ol.Map({
	target: 'map',
	layers: [
		new ol.layer.Tile({
		source: new ol.source.OSM()
	})],
	view: new ol.View({
	    projection: ol.proj.get('EPSG:3857'),
	    center: [14127388, 4517328],
	    zoom: 14
	})
});

//변수
let veil = $("#veil");
let menu = $("#menu");
let search = $("#search");
let inquire = $("#inquire");
let observe = $("#observe");
let analyze = $("#analyze");
let history = $("#history");
let side = $("#side");

//메인화면 -> 지도화면
veil.on("click", function(){
	if (veil.hasClass("veiled")) {
		veil.attr("class", "unveiled");
		menu.removeClass("bitMenu").addClass("smallMenu");
		search.attr("class", "smallMenuSearch");
		inquire.removeClass("bigMenuBtn").addClass("smallMenuBtn");
		observe.removeClass("bigMenuBtn").addClass("smallMenuBtn");
		analyze.removeClass("bigMenuBtn").addClass("smallMenuBtn");
		history.removeClass("bigMenuBtn").addClass("smallMenuBtn");
		side.css({"visibility":"visible", "width":"26.5%"});
	}
});

const url = "http://localhost:8888/geoserver/wms";

function addSafety(url){
	let layer = new ol.layer.Tile({
 	source: new ol.source.TileWMS({
   		url: url,
   		params: {
   			'LAYERS': 'Dukkeobi:safety'
            	, 'styles': ''
            	, 'cql_filter' : "safety_gub = '치안시설'"
         },
 	}),
	});
map.addLayer(layer);
}

//addSafety(url);

/* ===================srf-001=================== */
let search1 = $("#search1");
let searchBtn1 = $("#searchBtn1");
let selectSido = search1.children("select").first();
let selectSgg = $("#selectSgg");
let selectEmd = search1.children("select").last();
let resultAddr = $("#resultAddr");

// 태그 만들기
const sidoList = ["시/도", "강원도", "경기도", "경상남도", "경상북도", "광주광역시", "대구광역시", "대전광역시", "부산광역시", "서울특별시", "세종특별자치시", "울산광역시", "인천광역시", "전라남도", "전라북도", "제주특별자치도", "충청남도", "충청북도"];
const sggList = ["시/군/구", "강남구", "강동구", "강북구", "강서구", "관악구", "광진구", "구로구", "금천구", "노원구", "도봉구", "동대문구", "동작구", "마포구", "서대문구", "서초구", "성동구", "성북구", "송파구", "양천구", "영등포구", "용산구", "은평구", "종로구", "중구", "중랑구"];
const emdList = ["읍/면/동", "용감동", "대흥동", "염리동", "신수동", "서교동", "합정동", "망원1동", "망원2동", "연남동", "성산1동", "성산2동", "상암동", "도화동", "서강동", "공덕동", "아현동"];
function makeOptionTag(select, list) {
	select.innerHTML = "";
	let tags = "";
	$.each(list, function(index, item) {
		tags += `<option>${item}</option>`;
		
	});
	select.innerHTML = tags;
}
makeOptionTag(selectSido[0], sidoList);
makeOptionTag(selectSgg[0], sggList);
makeOptionTag(selectEmd[0], emdList);

// 선택된 주소 바꾸기

// 검색버튼 클릭하기
searchBtn1.on("click", function() {
	let selected = search1.children("select").last().val();
	searchEmd(url, selected);
});

// 검색 조건에 따른 조회하기
// 나중에 코드로 바꿔주기
function searchEmd(url, adm_nm) {
	let layer = new ol.layer.Tile({
		source : new ol.source.TileWMS({
			url : url
			, params : {
				layers : "Dukkeobi:mapogu_emd"
				, styles : "search_emd"
				, cql_filter : "adm_nm = " + adm_nm
			}
		})
	});
	map.addLayer(layer);
}
</script>
</body>
</html>