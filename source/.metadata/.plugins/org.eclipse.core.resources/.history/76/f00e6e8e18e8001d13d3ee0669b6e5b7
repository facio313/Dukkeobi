<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.forcewave.spatial.dao.SpatialDAO">

	<select id="" parameterType="String" resultType="kr.or.forcewave.safety.vo.SafetyVO">
		SELECT S.*, COUNT(1) AS CNT
		FROM SAFETY S
		INNER JOIN DORO_POLYGON D ON ST_DWITHIN(ST_SETSRID(D.GEOM, 3857), ST_SETSRID(S.GEOM, 3857), 500)
		WHERE D.BD_MGT_SN = #{clicked}
		GROUP BY S.GID
		ORDER BY CNT DESC
	</select>

</mapper>